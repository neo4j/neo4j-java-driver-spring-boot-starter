<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Gerrit Meier, Michael Simons">
<title>Neo4j Spring Boot Starter</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Neo4j Spring Boot Starter</h1>
<div class="details">
<span id="author" class="author">Gerrit Meier</span><br>
<span id="email" class="email"><a href="mailto:gerrit.meier@neo4j.com">gerrit.meier@neo4j.com</a></span><br>
<span id="author2" class="author">Michael Simons</span><br>
<span id="email2" class="email"><a href="mailto:michael.simons@neo4j.com">michael.simons@neo4j.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#manual-introduction">1. Intro</a>
<ul class="sectlevel2">
<li><a href="#whatsinthebox">1.1. What&#8217;s in the box?</a></li>
<li><a href="#doineedtheneo4jjavadriverspringbootstarter">1.2. Do I need the Neo4j Java Driver Spring Boot starter?</a></li>
<li><a href="#doesitworkwiththe1.7seriesofthedriver">1.3. Does it work with the 1.7 series of the driver?</a></li>
<li><a href="#doesitworkwiththeembeddeddatabase">1.4. Does it work with the embedded database?</a></li>
<li><a href="#whatswiththelongname">1.5. What&#8217;s with the long name?</a></li>
</ul>
</li>
<li><a href="#manual-getting-started">2. Getting started</a>
<ul class="sectlevel2">
<li><a href="#preparingthedatabase">2.1. Preparing the database</a></li>
<li><a href="#createanewspringbootproject">2.2. Create a new Spring Boot project</a></li>
<li><a href="#logging">2.3. Logging</a></li>
<li><a href="#production-readyfeatures">2.4. Production-ready features</a></li>
<li><a href="#healthinformation">2.5. Health information</a></li>
<li><a href="#drivermetrics">2.6. Driver metrics</a></li>
</ul>
</li>
<li><a href="#examples">3. Examples</a>
<ul class="sectlevel2">
<li><a href="#introduction">3.1. Introduction</a></li>
<li><a href="#collectingmetrics">3.2. Collecting metrics</a></li>
<li><a href="#web">3.3. Web</a></li>
<li><a href="#reactiveweb">3.4. Reactive Web</a></li>
<li><a href="#embedded-bolt-connection">3.5. Using an embedded database with the Driver starter</a></li>
<li><a href="#testing-with-neo4j-harness">3.6. Testing against the Neo4j harness</a></li>
<li><a href="#dedicatedroutingdriver">3.7. Dedicated routing driver</a></li>
<li><a href="#neo4j-ogm-integration">3.8. Neo4j-OGM Integration</a></li>
</ul>
</li>
<li><a href="#appendix">4. Appendix</a>
<ul class="sectlevel2">
<li><a href="#configurationoptions">Configuration options</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2020 Neo4j, Inc.,</p>
</div>
<div class="paragraph">
<p>License: <a href="license.html">Creative Commons 4.0</a></p>
</div>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>This is the manual for the Spring Boot Starter for Neo4j&#8217;s Java Driver (a.k.a. the Bolt Driver).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><em>Who should read this?</em></p>
</div>
<div class="paragraph">
<p>This manual is written for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>engineers setting up a Neo4j connection to a single Neo4j instance or a Neo4j cluster over the wire, without the need for object mapping</p>
</li>
<li>
<p>engineers who want to use Neo4j-OGM inside Spring Boot but needs access to the configuration options of the underlying Bolt driver.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manual-introduction"><a class="anchor" href="#manual-introduction"></a>1. Intro</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="whatsinthebox"><a class="anchor" href="#whatsinthebox"></a>1.1. What&#8217;s in the box?</h3>
<div class="paragraph">
<p>The Neo4j Java Driver Spring Boot starter provides both a Spring Boot <code>autoconfigure</code> and a <code>starter</code> module.
The <code>autoconfigure</code> module adds a single instance of <code>org.neo4j.driver.Driver</code> as a bean to the Spring Context if there is none
and registers health- and metric endpoints for all Driver-beans if the necessary Spring infrastructure is in place.</p>
</div>
<div class="paragraph">
<p>It does not bring any mapping facilities in addition the available functions of the driver nor Spring Data integration.
Have a look at <a href="https://github.com/neo4j/sdn-rx">Spring Data Neo4j⚡️RX</a> for reactive Spring Data Neo4j repositories.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The driver instance is a long living object that provides short living sessions as needed.
The instance does not need to be closed manually, that is done automatically when the application shuts down.
There is no need for external connection pooling.
This is done already in the driver and can be configured via properties.
Please have a look at the chapter {driver_manual_base}/sessions-transactions/[Sessions and transactions].
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="doineedtheneo4jjavadriverspringbootstarter"><a class="anchor" href="#doineedtheneo4jjavadriverspringbootstarter"></a>1.2. Do I need the Neo4j Java Driver Spring Boot starter?</h3>
<div class="paragraph">
<p>We recommend this starter for all new Spring Boot applications that want to use our new generation of drivers ("4.0").
The next generation of drivers is compatible with both 4.0.x and 3.5.x community and enterprise databases.
The starter takes away all the boilerplate code of configuring an instance of the driver and does support
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">externalized configuration</a>
for all aspects of the driver.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><i class="fa fa-check-square-o"></i> <em>You want to work directly with a 4.0 driver?</em>
The starter is for you.</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> <em>You want Spring Data Neo4j⚡️RX repositories?</em>
The automatic configuration for SDN-RX is dependent on this starter, so it is already there and you would use exactly
the same as described in this manual to configure your connection</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> <em>You have the previous generation of Spring Data Neo4j or Neo4j-OGM?</em>
Use the 4.0.x line of this starter with Spring Boot 2.2.x, Spring Data Neo4j 5.2.x and Neo4j-OGM 3.2.x.
Use the 1.7.5.x line of this starter with Spring Boot 2.1.x, Spring Data Neo4j 5.1.x and Neo4j-OGM 3.1.x.
Spring Boot recognizes the driver bean created by this starter and configures Neo4j-OGM accordingly. We also have an <a href="#neo4j-ogm-integration">example for that.</a>.
For reference see the <a href="https://github.com/neo4j/neo4j-ogm/wiki/Versions">Neo4j-OGM compatibility matrix</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="doesitworkwiththe1.7seriesofthedriver"><a class="anchor" href="#doesitworkwiththe1.7seriesofthedriver"></a>1.3. Does it work with the 1.7 series of the driver?</h3>
<div class="paragraph">
<p>The 1.7.x line of the starter is for the 1.7.x line of the driver, the 4.0.x line for the 4.0..x of the driver.</p>
</div>
</div>
<div class="sect2">
<h3 id="doesitworkwiththeembeddeddatabase"><a class="anchor" href="#doesitworkwiththeembeddeddatabase"></a>1.4. Does it work with the embedded database?</h3>
<div class="paragraph">
<p>If you enable the Bolt connector on the embedded instance, it does.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
However, it <strong>does not and will not</strong> startup an embedded instance for you.
           There are two main reasons for this decisions:
          <br>
           First, we think that booting up a database from the connection layer (which the driver belongs to)
           or - even worse - from an object mapping layer - is wrong and violates the solid responsibility principle,
           thus, leading to all kinds of architectural problems.
          <br>
           Furthermore, Neo4j embedded is a full database engine and comes with a lot of dependencies and also in several
           versions and editions.
           Catering for all combinations and configuration possible will lead up to hard to maintain
           dependency management issues and also, duplication of configuration APIs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are two examples in which this starter works with an embedded database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#testing-with-neo4j-harness">Section 3.6</a> shows a couple of ways to add a <code>@Bean</code> of type <code>org.neo4j.harness.Neo4j</code> (Neo4j 4.0) or <code>org.neo4j.harness.ServerControls</code> (Neo4j 3.5 and prior)
to the application context. Those types represent the Neo4j test harness and provide an embedded instance, accessible via Bolt.
The Bolt connector is always enabled with the test harness.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="whatswiththelongname"><a class="anchor" href="#whatswiththelongname"></a>1.5. What&#8217;s with the long name?</h3>
<div class="paragraph">
<p><code>neo4j-java-driver-spring-boot-starter</code> is quite a long name for a module, we get that.
However, it follows the official Spring Boot convention described <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html#boot-features-custom-starter-naming">here</a>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>As a rule of thumb, you should name a combined module after the starter. For example, assume that you are creating a starter for "acme" and that you name the auto-configure module acme-spring-boot-autoconfigure and the starter acme-spring-boot-starter. If you only have one module that combines the two, name it acme-spring-boot-starter.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Our "acme" module is the Neo4j Java Driver, project name <code>neo4j-java-driver</code> and things add up from there, that&#8217;s all.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manual-getting-started"><a class="anchor" href="#manual-getting-started"></a>2. Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As with any other Spring Boot starter, the only thing you have to do is to include the starter module via your dependency management.
If you don&#8217;t configure anything, than the starter assumes <code>bolt://localhost:7687</code> as Neo4j URI and a server that has disabled authentication.</p>
</div>
<div class="paragraph">
<p>If only a single URI is provided, than the configuration tries to use that.
Otherwise, it passes all URIs to the Java driver which in turn uses the first one that is a reachable <code>bolt+routing</code> instance.</p>
</div>
<div class="paragraph">
<p>The automatic configuration will fail fast if the driver cannot connect to a single Neo4j database or to a routing server.</p>
</div>
<div class="paragraph">
<p>The Neo4j driver supports three different programming models:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Blocking database access (much like standard JDBC)</p>
</li>
<li>
<p>Asynchronous programming based on JDKs completable futures and related infrastructure</p>
</li>
<li>
<p>Reactive programming based on <a href="http://www.reactive-streams.org">Reactive Streams</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those are all included in the same binary.
The reactive programming model however requires a 4.0 Neo4j server on the database side and reactive Spring on the other hand.
To make the following intro as accessible as possible, we only display the blocking database access.
Have a look at the <a href="https://github.com/neo4j/neo4j-java-driver-spring-boot-starter/tree/master/examples">examples directory</a> for a reactive web application example.</p>
</div>
<div class="sect2">
<h3 id="preparingthedatabase"><a class="anchor" href="#preparingthedatabase"></a>2.1. Preparing the database</h3>
<div class="paragraph">
<p>For this example, we stay within the <a href="https://neo4j.com/developer/movie-database/">movie graph</a>,
as it comes for free with every Neo4j instance.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t have a running database but Docker installed, please run:</p>
</div>
<div id="start-docker-neo4j" class="listingblock">
<div class="title">Listing 1. Start a local Neo4j instance inside Docker.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker run --publish=7474:7474 --publish=7687:7687 neo4j:4.2.4</code></pre>
</div>
</div>
<div class="paragraph">
<p>You know can access <a href="http://localhost:7474/browser/?cmd=play&amp;arg=movies">http://localhost:7474</a>.
At first visit, you have to change your password. We chose <code>secret</code>  in the examples.
Note the command ready to run in the prompt.
Execute it to fill your database with some test data.</p>
</div>
</div>
<div class="sect2">
<h3 id="createanewspringbootproject"><a class="anchor" href="#createanewspringbootproject"></a>2.2. Create a new Spring Boot project</h3>
<div class="paragraph">
<p>The easiest way to setup a Spring Boot project is <a href="https://start.spring.io">start.spring.io</a>
 (which is integrated in the major IDEs as well, in case you don&#8217;t want to use the website).</p>
</div>
<div class="paragraph">
<p>Select the "Spring Web Starter" to get all the dependencies needed for creating a Spring based web application.
The Spring Initializr will take care of creating a valid project structure for you,
with all the files and settings in place for the selected build tool.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Don&#8217;t choose Spring Data Neo4j here, as it will get you the previous generation of Spring Data Neo4j including OGM and additional abstraction over the driver.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="maven"><a class="anchor" href="#maven"></a>2.2.1. Maven</h4>
<div class="paragraph">
<p>You can issue a CURL request against the Spring Initializer to create a basic Maven project:</p>
</div>
<div id="generate-maven-project" class="listingblock">
<div class="title">Listing 2. Create a basic Maven project with the Spring Initializr</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl https://start.spring.io/starter.tgz \
  -d dependencies=web,actuator \
  -d bootVersion=2.3.9.RELEASE \
  -d baseDir=Neo4jSpringBootExample \
  -d name=Neo4j%20SpringBoot%20Example | tar -xzvf -</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create a new folder <code>Neo4jSpringBootExample</code>.
As this starter is not yet on the initializer, you&#8217;ll have to add the following dependency manually to your  <code>pom.xml</code>:</p>
</div>
<div id="dependencies-maven" class="listingblock">
<div class="title">Listing 3. Inclusion of the neo4j-java-driver-spring-boot-starter in a Maven project</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.neo4j.driver<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>neo4j-java-driver-spring-boot-starter<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>4.2-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You would also add the dependency manually in case of an existing project.</p>
</div>
</div>
<div class="sect3">
<h4 id="gradle"><a class="anchor" href="#gradle"></a>2.2.2. Gradle</h4>
<div class="paragraph">
<p>The idea is the same, just generate a Gradle project:</p>
</div>
<div id="generate-gradle-project" class="listingblock">
<div class="title">Listing 4. Create a basic Gradle project with the Spring Initializr</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl https://start.spring.io/starter.tgz \
  -d dependencies=web,actuator \
  -d type=gradle-project \
  -d bootVersion=2.3.9.RELEASE \
  -d baseDir=Neo4jSpringBootExampleGradle \
  -d name=Neo4j%20SpringBoot%20Example | tar -xzvf -</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dependency for Gradle looks like this and must be added to <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Inclusion of the neo4j-java-driver-spring-boot-starter in a Gradle project</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    compile <span class="string"><span class="delimiter">'</span><span class="content">org.neo4j.driver:neo4j-java-driver-spring-boot-starter:4.2-SNAPSHOT</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You would also add the dependency manually in case of an existing project.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration"><a class="anchor" href="#configuration"></a>2.2.3. Configuration</h4>
<div class="paragraph">
<p>Now open any of those projects in your favorite IDE.
Find <code>application.properties</code> and configure your Neo4j credentials:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">org.neo4j.driver.uri=bolt://localhost:7687
org.neo4j.driver.authentication.username=neo4j
org.neo4j.driver.authentication.password=secret</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The URI is required. Autoconfiguration will not be triggered without it.
           This is to avoid clashes with the Spring Boot SDN/OGM starter.
           The SDN/OGM starter defaults to localhost, but backs off when it detects a driver bean.
           If this starter here would default to localhost as well, a driver bean would always be
           provided and SDN/OGM would back off even when a user configured a different URI.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is the bare minimum of what you need to connect to a Neo4j instance.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="#configurationoptions">the list of configuration properties</a> for all options this driver supports.</p>
</div>
<div class="paragraph">
<p>While the above configuration is presented in the easiest format (an <code>application.properties</code> file),
you are of course free to use any other declarative way to define properties in Spring Boot.
Please checkout the chapter <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config">Externalized Configuration</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is not necessary to add any programmatically configuration of the driver when you use this starter.
      While it may work, we strongly discourage and don&#8217;t support additional, pragmatical configuration of the Neo4j driver when using this starter.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="examplecrudcontroller"><a class="anchor" href="#examplecrudcontroller"></a>2.2.4. Example CRUD Controller</h4>
<div class="paragraph">
<p>Add the following <code>@RESTController</code> to your application:</p>
</div>
<div id="MovieController1" class="listingblock">
<div class="title">Listing 6. MovieController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example.demo</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="keyword">import</span> <span class="include">org.neo4j.driver.AccessMode</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.Driver</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.Session</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.SessionConfig</span>;
<span class="keyword">import</span> <span class="include">org.springframework.http.MediaType</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.GetMapping</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.RestController</span>;

<span class="annotation">@RestController</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MoviesController</span> {

        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Driver</span> driver; <i class="conum" data-value="1"></i><b>(1)</b>

        <span class="directive">public</span> MoviesController(<span class="predefined-type">Driver</span> driver) { <i class="conum" data-value="2"></i><b>(2)</b>
                <span class="local-variable">this</span>.driver = driver;
        }

        <span class="annotation">@GetMapping</span>(path = <span class="string"><span class="delimiter">&quot;</span><span class="content">/movies</span><span class="delimiter">&quot;</span></span>, produces = MediaType.APPLICATION_JSON_VALUE) <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getMovieTitles() {

                <span class="keyword">try</span> (Session session = driver.session()) { <i class="conum" data-value="4"></i><b>(4)</b>
                        <span class="keyword">return</span> session.run(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (m:Movie) RETURN m ORDER BY m.name ASC</span><span class="delimiter">&quot;</span></span>)
                                .list(r -&gt; r.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>).asNode().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).asString());
                }
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An instance field to hold the driver</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The driver is injected via constructor injection</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A mapping to the url <code>/movies</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Using the driver to get a short lived session and issue a query on it</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you generated your application via the commands given above, you can now run the class <code>Neo4jSpringBootExampleApplication</code>
and after a short while, you can access <a href="http://localhost:8080/movies" class="bare">http://localhost:8080/movies</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logging"><a class="anchor" href="#logging"></a>2.3. Logging</h3>
<div class="paragraph">
<p>The Neo4j Spring Boot starter uses a small shim to integrate the driver with Springs JCL abstraction.
Thus, all logging configuration can be done via Spring Boot&#8217;s <code>application.properties</code>.
Important names used for logging are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">logging.level.org.neo4j.driver.GraphDatabase = debug
logging.level.org.neo4j.driver.Driver = debug</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you ever have the need to debug outgoing and incoming Bolt messages, use those two names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">logging.level.org.neo4j.driver.OutboundMessageHandler = debug
logging.level.org.neo4j.driver.InboundMessageDispatcher = debug</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The prefix <code>org.neo4j.driver</code> is specific to the Drivers integration with Spring Boot.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="production-readyfeatures"><a class="anchor" href="#production-readyfeatures"></a>2.4. Production-ready features</h3>
<div class="paragraph">
<p>The Neo4j Spring Boot starter hooks into Spring Boot&#8217;s <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready.html">Production-ready features</a> (or the so called Spring Boot Actuator).
This happens automatically when you add the Spring Boot Actuator Starter like this:</p>
</div>
<div id="actuator-maven" class="listingblock">
<div class="title">Listing 7. Spring Boot Starter Actuator dependency with Maven</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or with Gradle:</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. Spring Boot Starter Actuator dependency with Gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    compile <span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-starter-actuator</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We support both the <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html#production-ready-health">health-</a> and <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-metrics.html">metrics-actuator</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="healthinformation"><a class="anchor" href="#healthinformation"></a>2.5. Health information</h3>
<div class="paragraph">
<p>Both reactive and imperative health checks are available,
with the reactive health checks having precedence when Project Reactor is detected.</p>
</div>
<div class="paragraph">
<p>When calling the health endpoint <code>/actuator/health</code> and the driver can reach a Neo4j instance, an unauthenticated user will see</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. Health information</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and an authenticated user will see</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. Health information</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UP</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Neo4j/4.0.0@localhost(127.0.0.1):7687</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">database</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case no instance is reachable, the status will be <code>DOWN</code> and the details carry the error message.</p>
</div>
<div class="paragraph">
<p>To disable the Neo4j health indicator, use the standard Spring Boot property <code>management.health.neo4j.enabled</code> with a value of <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="drivermetrics"><a class="anchor" href="#drivermetrics"></a>2.6. Driver metrics</h3>
<div class="paragraph">
<p><code>neo4j-java-driver-spring-boot-starter</code> comes with support for <a href="https://micrometer.io">Micrometer metrics</a> out of the box.
It detects Micrometer on the classpath and binds the metrics of all instances of <code>org.neo4j.driver.Driver</code>, that have enabled their metrics, to a micrometer registry.</p>
</div>
<div class="paragraph">
<p>To enable metrics for the driver instance provided by this starter, set <code>org.neo4j.driver.config.metrics-enabled</code> to true.</p>
</div>
<div class="paragraph">
<p>The following metrics are exposes</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>neo4j.driver.connections.inUse</code> (Gauge)</p>
</li>
<li>
<p><code>neo4j.driver.connections.timedOutToAcquire</code> (Counter)</p>
</li>
<li>
<p><code>neo4j.driver.connections.closed</code> (Counter)</p>
</li>
<li>
<p><code>neo4j.driver.connections.failedToCreate</code> (Counter)</p>
</li>
<li>
<p><code>neo4j.driver.connections.created</code> (Counter)</p>
</li>
<li>
<p><code>neo4j.driver.connections.idle</code> (Gauge)</p>
</li>
<li>
<p><code>neo4j.driver.connections.acquired</code> (Counter)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All metrics will have the tags <code>name</code> (the bean of the driver they belong to)
and <code>poolId</code> (the id of the connection pool, that contributed to the corresponding counter or gauge).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>3. Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction"><a class="anchor" href="#introduction"></a>3.1. Introduction</h3>
<div class="paragraph">
<p>We provide several examples how to use this starter.
The reactive demo can only be used with Neo4j version 4.</p>
</div>
<div class="paragraph">
<p>Each example comes with a dedicated readme, that guides you through it.</p>
</div>
<div class="paragraph">
<p>The examples use the "Movie" data set, that you can install into your instance by going to the <a href="http://localhost:7474/browser/?cmd=play&amp;arg=movies">Neo4j Browser</a>.
Enter the command <code>:play movies</code> and follow the instructions.</p>
</div>
<div class="paragraph">
<p>The examples expect an instance with the username <code>neo4j</code> and the password <code>secret</code>.</p>
</div>
<div class="paragraph">
<p>All examples use Maven, however they work completely the same with Gradle.</p>
</div>
<div class="paragraph">
<p>Also, all examples follow Spring Boot conventions, especially:
Use the dependency management and starters, don&#8217;t provide dependencies for things that are available as a starter.
Use version properties for overwriting any managed version instead of an explicit version.</p>
</div>
<div class="paragraph">
<p>The examples all have the default main application class, that looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. A standard Spring Boot main application class</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.boot.SpringApplication</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleApplication</span> {

        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
                SpringApplication.run(SimpleApplication.class, args);
        }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="supportforvisualstudioremotecontainers"><a class="anchor" href="#supportforvisualstudioremotecontainers"></a>3.1.1. Support for Visual Studio Remote Containers</h4>
<div class="paragraph">
<p>To make playing with the examples a bit easier, we have support for <a href="https://code.visualstudio.com/docs/remote/remote-overview">VS Code Remote Development</a>.
Please follow the instructions at the link above for setting up your Visual Studio Code environment.</p>
</div>
<div class="paragraph">
<p>You can open <code>web</code>, <code>reactive-web</code> and <code>simple</code> in Visual Studio Code and let it build the container.
The development container will contain a Neo4j 4.0 database as well as the example project.
The database can be reached under <a href="http://localhost:7474">http://localhost:7474</a> with the username / password combination <code>neo4j/secret</code>.</p>
</div>
<div class="paragraph">
<p>The example than can be build and run via Visual Studios support for Spring Boot, which is automatically added to the development container.</p>
</div>
<div class="paragraph">
<p>The web examples are reachable on <a href="http://localhost:8080">http://localhost:8080</a> from both outside and inside Visual Studio Code.
Any changes to the code will be automatically reloaded and available.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="collectingmetrics"><a class="anchor" href="#collectingmetrics"></a>3.2. Collecting metrics</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This refers only to Driver metrics, not to the Neo4j server metrics.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>neo4j-java-driver-spring-boot-starter</code> comes with support for <a href="https://micrometer.io">Micrometer metrics</a> out of the box.
It detects Micrometer on the classpath and binds the metrics of all instances of ` org.neo4j.driver.Driver`, that have enabled their metrics, to a micrometer registry.</p>
</div>
<div class="paragraph">
<p>Add <code>org.springframework.boot:spring-boot-starter-actuator</code> to your Spring Boot application, to include Micrometer.
To enable metrics for the driver instance provided by this starter, set <code>org.neo4j.driver.config.metrics-enabled</code> to true then.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll find this in the <a href="#Reactive web example">[Reactive web example]</a>.
Spring Boot doesn&#8217;t expose the metrics endpoint over http by default, if you need this, your complete configuration looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. application.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># Enable metrics for the driver instance provided by this starter
org.neo4j.driver.config.metrics-enabled=true

# Expose metrics in addition to info and health over http
management.endpoints.web.exposure.include=info,health,metrics</code></pre>
</div>
</div>
<div class="paragraph">
<p>The metrics can be accessed like any other metrics by their name.
The following shows a CURL request retrieving the amount of acquired connections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>curl localhost:8080/actuator/metrics/neo4j.driver.connections.acquired|jq
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   287  100   287    0     0  32773      0 --:--:-- --:--:-- --:--:-- 35875
{
  "name": "neo4j.driver.connections.acquired",
  "description": "The amount of connections that have been acquired.",
  "baseUnit": "connections",
  "measurements": [
    {
      "statistic": "COUNT",
      "value": 102
    }
  ],
  "availableTags": [
    {
      "tag": "poolId",
      "values": [
        "localhost:7687"
      ]
    },
    {
      "tag": "name",
      "values": [
        "driver"
      ]
    }
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="web"><a class="anchor" href="#web"></a>3.3. Web</h3>
<div class="paragraph">
<p>This example shows the usage of the Neo4j Java driver in a standard Spring Web-MVC application in an imperative (blocking) way.</p>
</div>
<div class="paragraph">
<p>Find the source code under  <a href="https://github.com/neo4j/neo4j-java-driver-spring-boot-starter/tree/master/examples/web">examples/web</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="reactiveweb"><a class="anchor" href="#reactiveweb"></a>3.4. Reactive Web</h3>
<div class="paragraph">
<p>This example uses the <code>neo4j://</code> protocol, which by defaults uses routing.
Apart from that, the configuration is the same as with the simple example.</p>
</div>
<div class="paragraph">
<p>The driver is however used as a source for a reactive Neo4j session, which in turn produces results for a reactive Spring Rest Controller:</p>
</div>
<div id="reactive-we-example" class="listingblock">
<div class="title">Listing 13. DisplayMoviesController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">reactor.core.publisher.Flux</span>;
<span class="keyword">import</span> <span class="include">reactor.core.publisher.Mono</span>;

<span class="keyword">import</span> <span class="include">org.neo4j.driver.AccessMode</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.Driver</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.SessionConfig</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.reactive.RxSession</span>;
<span class="keyword">import</span> <span class="include">org.springframework.http.MediaType</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.GetMapping</span>;
<span class="keyword">import</span> <span class="include">org.springframework.web.bind.annotation.RestController</span>;

<span class="annotation">@RestController</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DisplayMoviesController</span> {

        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Driver</span> driver;

        <span class="directive">public</span> DisplayMoviesController(<span class="predefined-type">Driver</span> driver) {
                <span class="local-variable">this</span>.driver = driver;
        }

        <span class="annotation">@GetMapping</span>(path = <span class="string"><span class="delimiter">&quot;</span><span class="content">/movies</span><span class="delimiter">&quot;</span></span>, produces = MediaType.TEXT_EVENT_STREAM_VALUE)
        <span class="directive">public</span> Flux&lt;<span class="predefined-type">String</span>&gt; getMovieTitles() {

                SessionConfig sessionConfig = SessionConfig.builder().withDefaultAccessMode(AccessMode.READ).build();
                <span class="keyword">return</span> Flux.usingWhen(
                        Mono.fromSupplier(() -&gt; driver.rxSession(sessionConfig)),
                        s -&gt; Flux.from(s.run(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (m:Movie) RETURN m ORDER BY m.name ASC</span><span class="delimiter">&quot;</span></span>).records()),
                        RxSession::close
                ).map(r -&gt; r.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>).asNode().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).asString());
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="embedded-bolt-connection"><a class="anchor" href="#embedded-bolt-connection"></a>3.5. Using an embedded database with the Driver starter</h3>
<div class="paragraph">
<p>This example demonstrates a couple things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>How to provide an instance of the Neo4j <code>DatabaseManagementService</code> as a managed bean into a Spring context.</p>
</li>
<li>
<p>How to keep the configuration for the driver and the embedded instance in sync.</p>
</li>
<li>
<p>This starter can connect against an embedded instance with the Bolt connector enabled.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While the <a href="#testing-with-neo4j-harness">test harness example</a> focuses on having an embedded instance through the harness in
your context, this example focuses on having the embedded API for whatever reasons in your context.</p>
</div>
<div class="paragraph">
<p>One of those reasons might be that you want to be able to use the <code>GraphDatabaseService</code>
to execute Cypher without Bolt involved or traverse nodes manually.
Here is one made up example that uses the <code>GraphDatabaseService</code> to find all nodes with a label <code>Movie</code>:</p>
</div>
<div id="GraphDatabaseService-usecase" class="listingblock">
<div class="title">Listing 14. Accessing the <code>GraphDatabaseService</code> from a service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span>(var tx = databaseManagementService.database(<span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>).beginTx()) {
    <span class="keyword">return</span> tx.findNodes(<span class="predefined-type">Label</span>.label(<span class="string"><span class="delimiter">&quot;</span><span class="content">Movie</span><span class="delimiter">&quot;</span></span>))
        .stream()
        .map(n -&gt; n.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>))
        .map(<span class="predefined-type">String</span>.class::cast)
        .collect(Collectors.toList());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MovieService</code> in the sources of this example however is exactly the same as the one in the other examples.
It is not aware against what kind of server it is connected and just gets a Driver <code>Session</code> with <code>var session = driver.session()</code>.</p>
</div>
<div class="sect3">
<h4 id="provideamanagedembeddeddatabasemanagementserviceandkeepitinsyncwiththedriver."><a class="anchor" href="#provideamanagedembeddeddatabasemanagementserviceandkeepitinsyncwiththedriver."></a>3.5.1. Provide a managed, embedded <code>DatabaseManagementService</code> and keep it in sync with the driver.</h4>
<div class="paragraph">
<p>First, provide the necessary dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="comment">&lt;!-- Embbedded instance --&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.neo4j<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>neo4j<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>4.2.4<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="comment">&lt;!-- Necessary bolt server --&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.neo4j<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>neo4j-bolt<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>4.2.4<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on your setup, you might have to exclude the following artifact from both dependencies above: <code>org.slf4j:slf4j-nop</code>,
as it clashes with Spring Boots default logger.</p>
</div>
<div class="paragraph">
<p>The enterprise edition lives under different coordinates
(<code>com.neo4j:neo4j-enterprise</code>, which are not available in Maven central but only to customers).</p>
</div>
<div class="paragraph">
<p>Configuration is done with the following components:</p>
</div>
<div id="EmbeddedConfig-Properties" class="listingblock">
<div class="title">Listing 15. DatabaseManagementServiceProperties.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.io.File</span>;
<span class="keyword">import</span> <span class="include">java.util.Optional</span>;

<span class="keyword">import</span> <span class="include">org.springframework.boot.context.properties.ConfigurationProperties</span>;

<span class="annotation">@ConfigurationProperties</span>(prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.neo4j.database-management-service</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DatabaseManagementServiceProperties</span> {

        <span class="comment">/**
         * The default home directory. If not configured, a random, temporary directory is used.
         * If you want to keep your data around, please set it to a writeable path in your configuration.
         */</span>
        <span class="directive">private</span> Optional&lt;<span class="predefined-type">File</span>&gt; homeDirectory = Optional.empty(); <i class="conum" data-value="2"></i><b>(2)</b>

        <span class="directive">public</span> Optional&lt;<span class="predefined-type">File</span>&gt; getHomeDirectory() {
                <span class="keyword">return</span> homeDirectory;
        }

        <span class="directive">public</span> <span class="type">void</span> setHomeDirectory(Optional&lt;<span class="predefined-type">File</span>&gt; homeDirectory) {
                <span class="local-variable">this</span>.homeDirectory = homeDirectory;
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Make this class a component containing configurational properties under the prefix <code>org.neo4j.database-management-service</code>.
This prefix is the canonical form. Camel- and Snakecases (<code>databaseManagementService</code> respectivly <code>DATABASE_MANAGEMENT_SERVICE</code>
work as well.
These properties can come from <code>application.properties</code> or <code>application.yml</code> as well as from the environment and of course,
config servers.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This configuration is needed for the embedded instance. The embedded instance needs to store its data somewhere.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With a properties class like this, you can have all the relevant configuration properties in one place, instead of
manually juggling with <code>@Value</code> and related.</p>
</div>
<div id="EmbeddedConfig" class="listingblock">
<div class="title">Listing 16. Configuring the embedded instance with the driver in mind</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.System.Logger.Level</span>.*;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.io.UncheckedIOException</span>;
<span class="keyword">import</span> <span class="include">java.lang.System.Logger</span>;
<span class="keyword">import</span> <span class="include">java.net.URI</span>;
<span class="keyword">import</span> <span class="include">java.nio.file.Files</span>;

<span class="keyword">import</span> <span class="include">org.neo4j.configuration.connectors.BoltConnector</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.configuration.helpers.SocketAddress</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.dbms.api.DatabaseManagementService</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.dbms.api.DatabaseManagementServiceBuilder</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.springframework.boot.autoconfigure.Neo4jDriverProperties</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.context.properties.EnableConfigurationProperties</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.Bean</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.Condition</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.ConditionContext</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.Conditional</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.Configuration</span>;
<span class="keyword">import</span> <span class="include">org.springframework.core.type.AnnotatedTypeMetadata</span>;

<span class="annotation">@Configuration</span>(proxyBeanMethods = <span class="predefined-constant">false</span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@EnableConfigurationProperties</span>(DatabaseManagementServiceProperties.class)  <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Neo4jConfig</span> {

        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> LOGGER = <span class="predefined-type">System</span>.getLogger(Neo4jConfig.class.getName());

        <span class="annotation">@Bean</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="annotation">@Conditional</span>(OnDriverCouldConnectToEmbedded.class) <i class="conum" data-value="4"></i><b>(4)</b>
        DatabaseManagementService databaseManagementService(
                Neo4jDriverProperties driverProperties,
                DatabaseManagementServiceProperties serviceProperties
        ) {
                <i class="conum" data-value="5"></i><b>(5)</b>
                var homeDirectory = serviceProperties.getHomeDirectory().orElseGet(() -&gt; {
                        <span class="keyword">try</span> {
                                <span class="keyword">return</span> Files.createTempDirectory(<span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>).toFile();
                        } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
                                <span class="keyword">throw</span> <span class="keyword">new</span> UncheckedIOException(e);
                        }
                });
                LOGGER.log(
                        INFO,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Configuring {0} as home directory for the embedded instance.</span><span class="delimiter">&quot;</span></span>,
                        homeDirectory
                );

                var driverPort = driverProperties.getUri().getPort();
                var address = <span class="keyword">new</span> <span class="predefined-type">SocketAddress</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>, driverPort); <i class="conum" data-value="6"></i><b>(6)</b>
                <span class="keyword">return</span> <span class="keyword">new</span> DatabaseManagementServiceBuilder(homeDirectory)
                        .setConfig(BoltConnector.enabled, <span class="predefined-constant">true</span>)
                        .setConfig(BoltConnector.listen_address, address)
                        .build();
        }

        <span class="directive">static</span> <span class="type">class</span> <span class="class">OnDriverCouldConnectToEmbedded</span> <span class="directive">implements</span> <span class="predefined-type">Condition</span> { <i class="conum" data-value="7"></i><b>(7)</b>

                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">boolean</span> matches(ConditionContext context, AnnotatedTypeMetadata metadata) {

                        <span class="comment">// @formatter:off</span>
                        <span class="type">boolean</span> outcome = <span class="predefined-constant">false</span>;
                        <span class="predefined-type">URI</span> configuredBoltUri = context.getEnvironment().getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.neo4j.driver.uri</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">URI</span>.class);
                        <span class="keyword">if</span> (configuredBoltUri == <span class="predefined-constant">null</span>) {
                                LOGGER.log(WARNING, <span class="string"><span class="delimiter">&quot;</span><span class="content">Driver is not configured, skipping embedded instance as well.</span><span class="delimiter">&quot;</span></span>);
                        } <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="string"><span class="delimiter">&quot;</span><span class="content">bolt</span><span class="delimiter">&quot;</span></span>.equalsIgnoreCase(configuredBoltUri.getScheme())) {
                                LOGGER.log(WARNING, <span class="string"><span class="delimiter">&quot;</span><span class="content">Driver configured to use `{0}`, but embedded only supports bolt. Not configuring embedded.</span><span class="delimiter">&quot;</span></span>,  configuredBoltUri);
                        } <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>.equalsIgnoreCase(configuredBoltUri.getHost())) {
                                LOGGER.log(WARNING, <span class="string"><span class="delimiter">&quot;</span><span class="content">Driver configured to connect to `{0}`, not a local instance. Not configuring embedded.</span><span class="delimiter">&quot;</span></span>, configuredBoltUri.getHost());
                        } <span class="keyword">else</span> {
                                outcome = <span class="predefined-constant">true</span>;
                        }
                        <span class="comment">// @formatter:on</span>

                        <span class="keyword">return</span> outcome;
                }
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mark this class as a configurational bean.
We can make the startup of the Spring context a bit fast, as we don&#8217;t need to proxy the methods.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the class that represents the configuration properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This marks the returned value as Spring bean for the context</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We only fire up the embedded instance in some conditions.
This is optional, but makes perfect sense in a setup where both the embedded instance and the driver should be available.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We check if someone had configured the home directory for the instance.
If so, we use that, otherwise we default to something random.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Here, we use the same port that has been given to the driver for the port the embedded bolt listens to.
Choose any other port you want (or a random free one), but keep in mind,
that you have to reconfigure the driver as well then (through <code>org.neo4j.driver.uri</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>This is a <code>Condition</code> to be used with <code>@Conditional</code>.
It makes sure in 4. that we bring up an embedded instance only when the driver actually targets something on localhost via the bolt protocol.
This later step is completely optional, but keeps you from funny surprise.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="usingthedriveragainsttheembeddedinstance"><a class="anchor" href="#usingthedriveragainsttheembeddedinstance"></a>3.5.2. Using the driver against the embedded instance</h4>
<div class="paragraph">
<p>To the outside world, nothing indicates that the service runs against embedded:</p>
</div>
<div id="MovieService" class="listingblock">
<div class="title">Listing 17. Accessing the <code>GraphDatabaseService</code> from a service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">java.util.stream.Collectors</span>;

<span class="keyword">import</span> <span class="include">org.neo4j.dbms.api.DatabaseManagementService</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.Driver</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Autowired</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Service</span>;

<span class="annotation">@Service</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MoviesService</span> {

        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Driver</span> driver;

        <span class="directive">public</span> MoviesService(<span class="predefined-type">Driver</span> driver) {
                <span class="local-variable">this</span>.driver = driver;
        }

        <span class="annotation">@Autowired</span>
        DatabaseManagementService databaseManagementService;

        <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getMovieTitles() {

                <span class="keyword">try</span> (var session = driver.session()) {
                        <span class="keyword">return</span> session.run(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (m:Movie) RETURN m ORDER BY m.name ASC</span><span class="delimiter">&quot;</span></span>).stream()
                                .map(r -&gt; r.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>).asNode())
                                .map(n -&gt; n.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).asString())
                                .collect(Collectors.toList());
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can of course inject the <code>DatabaseManagementService</code> or - if you provide those as beans as well - dedicated
<code>GraphDatabaseService</code>-instances for the databases you want to work with.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s walk through a test setup.
The tests prepares the data directly against the embedded instance and than tests the service:</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. MoviesServiceTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.assertj.core.api.Assertions</span>.*;

<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeAll</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.dbms.api.DatabaseManagementService</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Autowired</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.test.context.SpringBootTest</span>;
<span class="keyword">import</span> <span class="include">org.springframework.test.context.DynamicPropertyRegistry</span>;
<span class="keyword">import</span> <span class="include">org.springframework.test.context.DynamicPropertySource</span>;
<span class="keyword">import</span> <span class="include">org.springframework.util.SocketUtils</span>;

<span class="annotation">@SpringBootTest</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">MoviesServiceTest</span> {

        <span class="annotation">@DynamicPropertySource</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="directive">static</span> <span class="type">void</span> neo4jProperties(DynamicPropertyRegistry registry) {

                <span class="comment">// Configure a free port</span>
                registry.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.neo4j.driver.uri</span><span class="delimiter">&quot;</span></span>, () -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">bolt://localhost:</span><span class="delimiter">&quot;</span></span> + SocketUtils.findAvailableTcpPort()); <i class="conum" data-value="3"></i><b>(3)</b>

                <span class="comment">// You could also point the embedded instance to some pre-seeded directory </span><i class="conum" data-value="4"></i><b>(4)</b>
                <span class="comment">// registry.add(</span>
                <span class="comment">//         &quot;org.neo4j.database-management-service.home-directory&quot;,</span>
                <span class="comment">//         () -&gt; &quot;/Users/msimons/tmp/preseededNeo4j&quot;</span>
                <span class="comment">// );</span>
        }

        <span class="annotation">@BeforeAll</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="directive">static</span> <span class="type">void</span> prepareTestData(
                <span class="annotation">@Autowired</span> DatabaseManagementService databaseManagementService
        ) {

                <span class="keyword">try</span> (var tx = databaseManagementService.database(<span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>).beginTx()) {
                        tx.execute(
                                <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrix:Movie {title:'The Matrix', released:1999, tagline:'Welcome to the Real World'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                                        + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrixReloaded:Movie {title:'The Matrix Reloaded', released:2003, tagline:'Free your mind'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                                        + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrixRevolutions:Movie {title:'The Matrix Revolutions', released:2003, tagline:'Everything that has a beginning has an end'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
                        tx.commit();
                }
        }

        <span class="annotation">@Test</span>
        <span class="type">void</span> shouldRetrieveMovieTitles(<span class="annotation">@Autowired</span> MoviesService moviesService) { <i class="conum" data-value="6"></i><b>(6)</b>

                assertThat(moviesService.getMovieTitles())
                        .hasSize(<span class="integer">3</span>)
                        .contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">The Matrix</span><span class="delimiter">&quot;</span></span>);
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Make it a standard, full blown <code>@SpringBootTest</code>, applying the same configuration found from walking the packages
starting at the <code>@SpringBootApplication</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This brings in dynamic test properties in the <code>registry</code>.
It is available since Spring Boot 2.2.6.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We use <code>SocketUtils</code> to find a random free port.
We give that random free port to the driver URI which is in turn used by <a href="#EmbeddedConfig">the embedded config</a> to configure the published Bolt port.
This is necessary to not clash with any running databases on the test machine.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Uncommenting the next line gives you the opportunity to point the embedded instance to a directory containing pre-seeded
data during test for example.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Springs JUnit 5 integration allows beans to be injected in all phases of a JUnit 5 test.
Here we use the <code>@BeforeAll</code> phase to access the embedded database to create test data.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>We want to test the service shown in <a href="#MovieService">MovieService.java</a>, which works with the driver.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-with-neo4j-harness"><a class="anchor" href="#testing-with-neo4j-harness"></a>3.6. Testing against the Neo4j harness</h3>
<div class="paragraph">
<p>We provide a special module that brings in the community edition of the Neo4j harness
and some additional utilities that hopefully make your life easier.</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.neo4j.driver<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j-java-driver-test-harness-spring-boot-autoconfigure<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>4.2-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need the enterprise edition, bring in the module like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 20. pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.neo4j.driver<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j-java-driver-test-harness-spring-boot-autoconfigure<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>4.2-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;exclusions&gt;</span>
        <span class="tag">&lt;exclusion&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.neo4j.test<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>neo4j-harness<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/exclusion&gt;</span>
    <span class="tag">&lt;/exclusions&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.neo4j.test<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j-harness-enterprise<span class="tag">&lt;/artifactId&gt;</span>
    <span class="comment">&lt;!-- See below regarding Neo4j version --&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.5.15<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;exclusions&gt;</span>
        <span class="tag">&lt;exclusion&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.slf4j<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>slf4j-nop<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/exclusion&gt;</span>
    <span class="tag">&lt;/exclusions&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The disadvantage: It brings a ton of dependencies.
The advantage: It starts very fast.
If you don&#8217;t want to have the dependencies and can live with a slower start, we recommend <a href="https://www.testcontainers.org/modules/databases/neo4j/">Testcontainers</a>.</p>
</div>
<div class="paragraph">
<p>They are easy to use and can be configured as shown in <a href="#option1">option 1 below</a> as well.</p>
</div>
<div class="sect3">
<h4 id="neo4j3.5orneo4j4.0"><a class="anchor" href="#neo4j3.5orneo4j4.0"></a>3.6.1. Neo4j 3.5 or Neo4j 4.0?</h4>
<div class="paragraph">
<p>Neo4j 3.5 and 4.0 have different requirements.
Neo4j 4.0 requires at least JDK 11.
We understand that not all of you are ready to go beyond JDK 8 (but you should).
Therefore we decided to build the Test harness support by default against Neo4j 3.5 and JDK 8.</p>
</div>
<div class="paragraph">
<p>To use Neo4j 4.0 as in the following examples, please add this to your build file</p>
</div>
<div class="listingblock">
<div class="title">Listing 21. pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.neo4j.test<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>neo4j-harness<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>4.2.4<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Be aware that the type of the 4.0 test harness is <code>org.neo4j.harness.Neo4j</code>.
The following examples use 4.0 (<code>org.neo4j.harness.Neo4j</code>) but are applicable to <code>ServerControlls</code>, too.</p>
</div>
</div>
<div class="sect3">
<h4 id="startinguptheneo4jharnessandmakingspringawareofit"><a class="anchor" href="#startinguptheneo4jharnessandmakingspringawareofit"></a>3.6.2. Starting up the Neo4j harness and making Spring aware of it</h4>
<div class="paragraph">
<p>There many different options.
The main question is always: <strong>How to make Spring Boot aware that it should use different configuration properties?</strong></p>
</div>
<div class="sect4">
<h5 id="option1"><a class="anchor" href="#option1"></a>Option 1: Add the embedded server as a Spring bean (recommended approach)</h5>
<div class="paragraph">
<p>The recommended approach is shown in <code>MoviesServiceAlt1Test</code>:</p>
</div>
<div id="test-harness-example-option1" class="listingblock">
<div class="title">Listing 22. MoviesServiceAlt1Test.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootTest</span>
<span class="type">class</span> <span class="class">MoviesServiceAlt1Test</span> {

    <span class="annotation">@TestConfiguration</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">static</span> <span class="type">class</span> <span class="class">TestHarnessConfig</span> {

        <span class="annotation">@Bean</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="directive">public</span> Neo4j neo4j() {
            <span class="keyword">return</span> Neo4jBuilders.newInProcessBuilder()
                .withDisabledServer() <span class="comment">// No need for http</span>
                .withFixture(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrix:Movie {title:'The Matrix', released:1999, tagline:'Welcome to the Real World'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrixReloaded:Movie {title:'The Matrix Reloaded', released:2003, tagline:'Free your mind'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrixRevolutions:Movie {title:'The Matrix Revolutions', released:2003, tagline:'Everything that has a beginning has an end'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                )
                .build();

            <span class="comment">// For enterprise use</span>
            <span class="comment">// return com.neo4j.harness.EnterpriseNeo4jBuilders.newInProcessBuilder()</span>
            <span class="comment">//    .newInProcessBuilder()</span>
            <span class="comment">//    .build();</span>
        }
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testSomethingWithTheDriver(<span class="annotation">@Autowired</span> <span class="predefined-type">Driver</span> driver) {
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is a test configuration only applicable for this test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This turns the embedded instance into a Spring Bean, bound to Springs lifecycle</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The autoconfiguration module for the test harness makes the starter aware of the harness and reconfigures the driver to use it.
This would be the recommended way of doing things.</p>
</div>
</div>
<div class="sect4">
<h5 id="option2"><a class="anchor" href="#option2"></a>Option 2: Use the provided harness instance</h5>
<div class="paragraph">
<p><code>MoviesServiceAlt2Test.java</code> demonstrates the fully automatic configuration of test harness and driver:</p>
</div>
<div id="test-harness-example-option2" class="listingblock">
<div class="title">Listing 23. MoviesServiceAlt2Test.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootTest</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MoviesServiceAlt2Test</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> MoviesService moviesService;

    <span class="annotation">@BeforeEach</span>
    <span class="type">void</span> prepareDatabase(<span class="annotation">@Autowired</span> Neo4j neo4j) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">try</span>(Transaction transaction = neo4j.defaultDatabaseService().beginTx()) {
            transaction.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n) DETACH DELETE n</span><span class="delimiter">&quot;</span></span>);
            transaction.execute(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrix:Movie {title:'The Matrix', released:1999, tagline:'Welcome to the Real World'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrixReloaded:Movie {title:'The Matrix Reloaded', released:2003, tagline:'Free your mind'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrixRevolutions:Movie {title:'The Matrix Revolutions', released:2003, tagline:'Everything that has a beginning has an end'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
            );
            transaction.commit();
        }
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testSomethingWithTheDriver(<span class="annotation">@Autowired</span> <span class="predefined-type">Driver</span> driver) {
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>As you don&#8217;t have access to the builder, you have to provide your fixtures through the embedded database service.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This may come in handy in some scenarios, but generally, using the builder API as shown above is preferable.
On the plus side: The automatic configuration of the harness takes care of disabling the embedded webserver (for Neo4j 4.0+).</p>
</div>
</div>
<div class="sect4">
<h5 id="option3"><a class="anchor" href="#option3"></a>Option 3: Start Neo4j outside Spring and apply its URL to configuration</h5>
<div class="paragraph">
<p>Here we start the embedded instance from the JUnit 5 context and
than use an <code>org.springframework.context.ApplicationContextInitializer</code> to apply <code>TestPropertyValues</code> to the Spring environment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You don&#8217;t actually need <code>neo4j-java-driver-test-harness-spring-boot-autoconfigure</code> for this solution. It&#8217;s enough to have the
      Test harness - either 3.5.x or 4.0.x or Community or enterprise edition on the classpath.
      If you have the test harness autoconfiguration support on the classpath, you have to explicitly disable it.
</td>
</tr>
</table>
</div>
<div id="test-harness-example-option3" class="listingblock">
<div class="title">Listing 24. MoviesServiceAlt3Test.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootTest</span>
<span class="annotation">@EnableAutoConfiguration</span>(exclude = { Neo4jTestHarnessAutoConfiguration.class }) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@ContextConfiguration</span>(initializers = { MoviesServiceAlt3Test.Initializer.class })
<span class="type">class</span> <span class="class">MoviesServiceAlt3Test</span> {

    <span class="directive">private</span> <span class="directive">static</span> Neo4j embeddedDatabaseServer;

    <span class="annotation">@BeforeAll</span>
    <span class="directive">static</span> <span class="type">void</span> initializeNeo4j() { <i class="conum" data-value="2"></i><b>(2)</b>

        embeddedDatabaseServer = Neo4jBuilders.newInProcessBuilder()
            .withDisabledServer() <i class="conum" data-value="3"></i><b>(3)</b>
            .withFixture(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrix:Movie {title:'The Matrix', released:1999, tagline:'Welcome to the Real World'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrixReloaded:Movie {title:'The Matrix Reloaded', released:2003, tagline:'Free your mind'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrixRevolutions:Movie {title:'The Matrix Revolutions', released:2003, tagline:'Everything that has a beginning has an end'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
            )
            .build();
    }

    <span class="annotation">@AfterAll</span>
    <span class="directive">static</span> <span class="type">void</span> closeNeo4j() { <i class="conum" data-value="4"></i><b>(4)</b>
        embeddedDatabaseServer.close();
    }

    <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="directive">static</span> <span class="type">class</span> <span class="class">Initializer</span> <span class="directive">implements</span> ApplicationContextInitializer&lt;ConfigurableApplicationContext&gt; {
        <span class="directive">public</span> <span class="type">void</span> initialize(ConfigurableApplicationContext configurableApplicationContext) {
            TestPropertyValues.of(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">org.neo4j.driver.uri=</span><span class="delimiter">&quot;</span></span> + embeddedDatabaseServer.boltURI().toString(),
                <span class="string"><span class="delimiter">&quot;</span><span class="content">org.neo4j.driver.authentication.password=</span><span class="delimiter">&quot;</span></span>
            ).applyTo(configurableApplicationContext.getEnvironment());
        }
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testSomethingWithTheDriver(<span class="annotation">@Autowired</span> <span class="predefined-type">Driver</span> driver) {
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Disable the autoconfiguration (only needed if you have <code>neo4j-java-driver-test-harness-spring-boot-autoconfigure</code> on the classpath)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use a JUnit <code>BeforeAll</code> to boot Neo4j</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The driver uses only the Bolt port, not the http port, so we don&#8217;t need the embedded webserver (that option is only available in Neo4j Harness 4.0+)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Close it in an <code>AfterAll</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This the essential part: Apply the new configuration values.
This uses an <code>ApplicationContextInitializer</code> which can inject <code>TestPropertyValues</code> into the context before the context starts.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is a good solution It works well with both Community and enterprise edition and decouples the creation of the server from configuring the client.
The downside of it: You have to configure a lot of stuff manually and your mileage may vary.</p>
</div>
<div class="paragraph">
<p>Since Spring Boot 2.2.6 you have an additional option:
As of Spring Framework 5.2.5, the TestContext framework provides support for dynamic property sources via the <code>@DynamicPropertySource</code> annotation.
This annotation can be used in integration tests that need to add properties with dynamic values.
For more information, have a look at the <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/testing.html#testcontext-ctx-management-dynamic-property-sources">Spring Framework reference</a>.</p>
</div>
<div class="paragraph">
<p><a href="#test-harness-example-option4">Listing 25</a> is conceptionally the same variant as <a href="#test-harness-example-option3">Listing 24</a> but much more concise:</p>
</div>
<div id="test-harness-example-option4" class="listingblock">
<div class="title">Listing 25. MoviesServiceAlt4Test.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootTest</span>
<span class="annotation">@EnableAutoConfiguration</span>(exclude = { Neo4jTestHarnessAutoConfiguration.class })
<span class="type">class</span> <span class="class">MoviesServiceAlt4Test</span> {

    <span class="directive">private</span> <span class="directive">static</span> Neo4j embeddedDatabaseServer;

    <span class="annotation">@BeforeAll</span>
    <span class="directive">static</span> <span class="type">void</span> initializeNeo4j() {

        embeddedDatabaseServer = Neo4jBuilders.newInProcessBuilder()
            .withDisabledServer() <span class="comment">// No need for http</span>
            .withFixture(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrix:Movie {title:'The Matrix', released:1999, tagline:'Welcome to the Real World'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrixReloaded:Movie {title:'The Matrix Reloaded', released:2003, tagline:'Free your mind'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE (TheMatrixRevolutions:Movie {title:'The Matrix Revolutions', released:2003, tagline:'Everything that has a beginning has an end'})</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
            )
            .build();
    }


    <span class="annotation">@DynamicPropertySource</span>
    <span class="directive">static</span> <span class="type">void</span> neo4jProperties(DynamicPropertyRegistry registry) {
        registry.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.neo4j.driver.uri</span><span class="delimiter">&quot;</span></span>, embeddedDatabaseServer::boltURI);
        registry.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.neo4j.driver.authentication.password</span><span class="delimiter">&quot;</span></span>, () -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@AfterAll</span>
    <span class="directive">static</span> <span class="type">void</span> closeNeo4j() {
        embeddedDatabaseServer.close();
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testSomethingWithTheDriver(<span class="annotation">@Autowired</span> <span class="predefined-type">Driver</span> driver) {
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="runningyourowndriverbean"><a class="anchor" href="#runningyourowndriverbean"></a>Running your own driver bean</h5>
<div class="paragraph">
<p>You can always fall back to create your own driver bean, but that actually disables the starter for the driver.
That is of course ok, but you might end up with a very different configuration in test than in production.
For example the driver will not use Spring logging, but its own default.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dedicatedroutingdriver"><a class="anchor" href="#dedicatedroutingdriver"></a>3.7. Dedicated routing driver</h3>
<div class="paragraph">
<p>Usually, a Neo4j cluster should be identified by one logical <code>neo4j://</code> URL.
This can be a load balancer, a DNS resolver, anything that turns the URL into a clusters entry point.
There are however edge cases in which this is not feasible and you might want to pass multiple, physical <code>neo4j://</code> URLs to the driver.</p>
</div>
<div class="paragraph">
<p>We don&#8217;t offer a dedicated configuration flag for that.
The solution here is to define your own Driver-bean, but you can reuse our <code>Neo4jDriverProperties</code> that saves you from manually reading configuration properties.</p>
</div>
<div class="paragraph">
<p>The configuration is stored in <code>src/main/resources/application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># Those are &quot;our&quot; standard properties
org.neo4j.driver.authentication.username=neo4j
org.neo4j.driver.authentication.password=secret

# Use the one you need
org.neo4j.driver.pool.max-connection-pool-size=50

# This is a custom property, can have any name you want
my.physical.neo4j.uris=\
  neo4j://localhost:7687,\
  neo4j://localhost:7688,\
  neo4j://localhost:7689</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the custom URIs, add a configuration class like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.net.URI</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="keyword">import</span> <span class="include">org.neo4j.driver.AuthToken</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.Config</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.Driver</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.GraphDatabase</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.springframework.boot.autoconfigure.Neo4jDriverProperties</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Value</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.Bean</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.Configuration</span>;

<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RoutingDriverConfiguration</span> {

        <span class="annotation">@Bean</span>
        <span class="directive">public</span> <span class="predefined-type">Driver</span> neo4jDriver(
                <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${my.physical.neo4j.uris}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">List</span>&lt;<span class="predefined-type">URI</span>&gt; routingUris, <i class="conum" data-value="1"></i><b>(1)</b>
                Neo4jDriverProperties neo4jDriverProperties <i class="conum" data-value="2"></i><b>(2)</b>
        ) {

                AuthToken authToken = neo4jDriverProperties.getAuthToken(); <i class="conum" data-value="3"></i><b>(3)</b>
                Config config = neo4jDriverProperties.asDriverConfig();

                <span class="keyword">return</span> GraphDatabase.routingDriver(routingUris, authToken, config); <i class="conum" data-value="4"></i><b>(4)</b>
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Map your custom property with <code>@Value</code> onto a list of Strings or URIs.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Let our machinery inject <code>Neo4jDriverProperties</code>, that includes all of our properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the convenience methods to create <code>org.neo4j.driver.AuthToken</code> and <code>org.neo4j.driver.Config</code> as needed.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Call the dedicated <code>routingDriver</code> method</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="neo4j-ogm-integration"><a class="anchor" href="#neo4j-ogm-integration"></a>3.8. Neo4j-OGM Integration</h3>
<div class="paragraph">
<p>The current Spring Boot starter you get on <a href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=2.2.6.RELEASE&amp;packaging=jar&amp;jvmVersion=1.8&amp;groupId=com.example&amp;artifactId=demo&amp;name=demo&amp;description=Demo%20project%20for%20Spring%20Boot&amp;packageName=com.example.demo&amp;dependencies=data-neo4j">start.spring.io</a> recognizes the driver bean created by this starter here.
That means you can add this starter via <code>org.neo4j.driver:neo4j-java-driver-spring-boot-starter:4.2-SNAPSHOT</code> and use the properties under <code>org.neo4j.driver</code> to configure the connection.
Thus you don&#8217;t have to work your way into Neo4j-OGM to manipulate the encapsulated driver but inject a correctly configured driver bean into the Neo4j-OGM session factory.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="#appendix"></a>4. Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configurationoptions"><a class="anchor" href="#configurationoptions"></a>Configuration options</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.authentication.kerberos-ticket</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A kerberos ticket for connecting to the database. Mutual exclusive with a given username.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.authentication.password</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password of the user connecting to the database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.authentication.realm</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The realm to connect to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.authentication.username</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The login of the user connecting to the database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.pool.connection-acquisition-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acquisition of new connections will be attempted for at most configured timeout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.config.connection-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify socket connection timeout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.config.encrypted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag, if the driver should use encrypted traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.pool.idle-time-before-connection-test</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pooled connections that have been idle in the pool for longer than this timeout will be tested before they are used again.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.pool.log-leaked-sessions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag, if leaked sessions logging is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.pool.max-connection-lifetime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pooled connections older than this threshold will be closed and removed from the pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.pool.max-connection-pool-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>100</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum amount of connections in the connection pool towards a single database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.config.max-transaction-retry-time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the maximum time transactions are allowed to retry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.config.server-address-resolver-class</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a custom server address resolver used by the routing driver to resolve the initial address used to create the driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.config.trust-settings.cert-file</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file of the certificate to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.config.trust-settings.hostname-verification-enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag, if hostname verification is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.config.trust-settings.strategy</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the strategy to use use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.uri</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uri this driver should connect to. The driver supports bolt or neo4j as schemes. The starter does not provide a default URI so that clashes with the SDN/OGM Spring Boot starter are avoided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.neo4j.driver.pool.metrics-enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set this to true, so that the driver collects metrics, which can be exported to Micrometer.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-04-08 18:24:56 UTC
</div>
</div>
</body>
</html>